<main class="global-main card-wrapper">
  <div class="card page-content">
    <div class="top row space-between">
      <app-input-search
        [value]="searchParam"
        (onChange)="onChangeSearchInputHandler($event)"
      ></app-input-search>
      <div class="filter-wrapper">
        <app-filter-btn
          title="Показать фильтры поиска"
          [target]="'filter_devices'"
        ></app-filter-btn>
      </div>
      <app-add-button
        *ngIf="userRole === 'admin' || userRole === 'super'"
        [title]="'добавить устройство'"
        [target]="'add_device'"
      ></app-add-button>
    </div>
    <app-devices-filters></app-devices-filters>
    <ng-container
      *ngIf="
        (_dLoading | async) ||
          false ||
          (_gLoading | async) ||
          false ||
          (_cLoading | async) ||
          false;
        else dummy
      "
    >
      <div class="progress">
        <div class="indeterminate"></div>
      </div>
    </ng-container>
    <ng-template #dummy>
      <div class="dummy"></div>
    </ng-template>
    <app-selected-elements
      *ngIf="userRole === 'admin' || userRole === 'super'"
      [editTarget]="'edit_several_devices'"
      [deleteTarget]="'delete_several_elements'"
    ></app-selected-elements>
    <div class="list">
      <div class="list-header">
        <div
          class="checkbox-wrapper"
          *ngIf="userRole === 'admin' || userRole === 'super'"
        >
          <app-input-checkbox
            [value]="isAllSelected"
            (onChange)="selectUnselectDevices()"
          ></app-input-checkbox>
        </div>
        <div class="sort-headers row space-between">
          <div class="sort-btn-wrapper status">
            <app-sort-btn
              [title]="'Статус'"
              [isSortAsc]="sortStatusAsc"
              (onCLick)="changeSortStatusDir()"
            ></app-sort-btn>
          </div>
          <div class="sort-btn-wrapper date">
            <app-sort-btn
              [title]="'Дата обн.'"
              [isSortAsc]="sortDateAsc"
              (onCLick)="changeSortDateDir()"
            ></app-sort-btn>
          </div>
          <div class="sort-btn-wrapper name">
            <app-sort-btn
              [title]="'Название'"
              [isSortAsc]="sortNameAsc"
              (onCLick)="changeSortNameDir()"
            ></app-sort-btn>
          </div>
          <p class="descr">Описание</p>
          <p class="phone">Телефон</p>
          <!--          <p>IMEI</p>-->
          <!--          <p>Модель</p>-->
          <p class="phone_imei">Модель / IMEI</p>
          <div class="sort-btn-wrapper group">
            <app-sort-btn
              [title]="'Группа'"
              [isSortAsc]="sortGroupAsc"
              (onCLick)="changeSortGroupDir()"
            ></app-sort-btn>
          </div>
          <p class="conf">Конфигурация</p>
          <p class="update">Обнов-е</p>
          <p class="version">Версия<br />лаунчера</p>
          <div class="sort-btn-wrapper battery">
            <app-sort-btn
              [title]="'Заряд'"
              [isSortAsc]="sortBatteryAsc"
              (onCLick)="changeSortBatteryDir()"
            ></app-sort-btn>
          </div>
          <p class="lock" *ngIf="userRole === 'admin' || userRole === 'super'">
            Блок
          </p>
          <p class="actions">Действия</p>
        </div>
      </div>
      <div class="list-body">
        <ng-container *ngIf="_devices.length !== 0; else nodata">
          <app-device-item
            *ngFor="
              let device of _devices
                | search: searchParam:'device'
                | devicesFilter
                  : filters.status
                  : filters.dateFrom
                  : filters.dateTo
                  : filters.configsIDs
                  : filters.groupsIDs
                | devices_status: sortStatusAsc
                | devices_date: sortDateAsc
                | devices_group: _groups:sortGroupAsc
                | devices_battery: sortBatteryAsc
                | devices_name: sortNameAsc
            "
            [device]="device"
            [userRole]="userRole"
          ></app-device-item>
        </ng-container>
        <ng-template #nodata>
          <app-no-list-data></app-no-list-data>
        </ng-template>
      </div>
    </div>
  </div>
</main>

<app-filter-devices></app-filter-devices>

<ng-container *ngIf="userRole === 'admin' || userRole === 'super'">
  <app-add-device></app-add-device>
  <app-qr-code></app-qr-code>
  <app-edit-device></app-edit-device>
  <app-edit-several-devices></app-edit-several-devices>
  <app-delete-device></app-delete-device>
  <app-delete-several-elements
    [source]="'device'"
  ></app-delete-several-elements>
  <app-list-files [source]="'device'"></app-list-files>
  <app-add-file [source]="'device'"></app-add-file>
  <app-delete-file [source]="'device'"></app-delete-file>
</ng-container>
