<app-global-container class="global-container">
  <app-page-header class="global-header"
    [title]="'Устройства'"
  ></app-page-header>

  <app-card class="global-main"
    [color]="'light-grey'"
  >
    <div class="page-content">
      <div class="top row space-between">
        <app-search-input
          [value]="searchParam"
          (onChange)="onChangeSearchInputHandler($event)"
        ></app-search-input>
        <div class="filter-wrapper">
          <app-filter-btn
            [target]="'filter_devices'"
          ></app-filter-btn>
        </div>
        <app-add-button
          [title]="'добавить устройство'"
          [target]="'add_device'"
        ></app-add-button>
      </div>
      <app-selected-elements
        *ngIf="selectedDevicesIDs.length !== 0"
        [devicesIDs]="selectedDevicesIDs"
        [editTarget]="'edit_several_devices'"
        [deleteTarget]="'delete_several_elements'"
        (onCloseClick)="cancelSelection()"
      ></app-selected-elements>
      <div class="list">
        <div class="list-header">
          <div class="checkbox-wrapper">
            <app-checkbox
              [isChecked]="isAllSelected"
              (onChange)="selectUnselectDevices()"
            ></app-checkbox>
          </div>
          <div class="sort-headers row space-between">
            <div class="sort-btn-wrapper status">
              <app-sort-btn
                [title]="'Статус'"
                [isSortAsc]="sortStatusAsc"
                (onCLick)="changeSortStatusDir()"
              ></app-sort-btn>
            </div>
            <div class="sort-btn-wrapper date">
              <app-sort-btn
                [title]="'Дата обн.'"
                [isSortAsc]="sortDateAsc"
                (onCLick)="changeSortDateDir()"
              ></app-sort-btn>
            </div>
            <div class="sort-btn-wrapper name">
              <app-sort-btn
                [title]="'Название'"
                [isSortAsc]="sortNameAsc"
                (onCLick)="changeSortNameDir()"
              ></app-sort-btn>
            </div>
            <p>Описание</p>
            <p>Телефон</p>
            <p>IMEI</p>
            <p>Модель</p>
            <div class="sort-btn-wrapper group">
              <app-sort-btn
                [title]="'Группа'"
                [isSortAsc]="sortGroupAsc"
                (onCLick)="changeSortGroupDir()"
              ></app-sort-btn>
            </div>
            <p>Конфигурация</p>
            <p>Обновление</p>
            <div class="sort-btn-wrapper battery">
              <app-sort-btn
                [title]="'Заряд'"
                [isSortAsc]="sortBatteryAsc"
                (onCLick)="changeSortBatteryDir()"
              ></app-sort-btn>
            </div>
            <p>Блокировка</p>
            <p>Действия</p>
          </div>
        </div>
        <div class="list-body">
          <app-device-item
            *ngFor="
              let device of devices
                | devicesFilter
                  : devicesFilters.status
                  : devicesFilters.dateFrom
                  : devicesFilters.dateTo
                  : devicesFilters.configsIDs
                  : devicesFilters.groupsIDs
                | search: searchParam:'device'
                | devicesByStatus: sortStatusAsc
                | devicesByDate: sortDateAsc
                | devicesByGroup: groups : sortGroupAsc
                | devicesByBattery: sortBatteryAsc
                | devicesByName: sortNameAsc
              "
            [device]="device"
            [groups]="groups"
            [configs]="configs"
            (onSelectUnselectDevice)="selectUnselectDevice($event)"
            (onChangeDeviceState)="changeDeviceState($event)"
            (onClickDeviceQRCode)="getDeviceQRCode($event)"
            (onClickDeviceEdit)="selectDeviceToEdit($event)"
            (onClickDeviceDelete)="selectDeviceToDelete($event)"
          ></app-device-item>
        </div>
      </div>
    </div>
  </app-card>
</app-global-container>

<app-filter-devices
  [configs]="configs"
  [groups]="groups"
  (onCancel)="resetSearchParams()"
  (onSubmit)="searchDevicesWithParams()"
></app-filter-devices>
<app-add-device
  [groups]="groups"
  (onSubmit)="addDevice()"
></app-add-device>
<app-qr-code
  [device]="currDevice"
></app-qr-code>
<app-edit-device
  [groups]="groups"
  (onSubmit)="editDevice()"
></app-edit-device>
<app-edit-several-devices
  [groups]="groups"
  (onSubmit)="editSeveralDevices()"
></app-edit-several-devices>
<app-delete-device
  [device]="currDevice"
  (onSubmit)="deleteDevice($event)"
></app-delete-device>
<app-delete-several-elements
  (onSubmit)="deleteSeveralDevices()"
></app-delete-several-elements>
