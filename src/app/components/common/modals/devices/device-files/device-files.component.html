<app-modal [modalID]="'device_files'" [isClosable]="true">
  <div class="modal-form">
    <div class="modal-form-header">
      <h4 class="text-title text-center">
        Файлы на устройстве {{ device?.name }}
      </h4>
      <hr class="divider" />
    </div>
    <div class="modal-form-body">
      <div class="row filters">
        <app-input-search
          [value]="searchTerm"
          (onChange)="onChangeSearchInputHandler($event)"
        ></app-input-search>
        <app-button
          class="files-filter-btn-all"
          [class.chosen]="displayFiles === 'all'"
          height="auto"
          padding="9px 14px"
          text="все"
          textLike="like-body"
          radius="14px"
          [color]="displayFiles === 'all' ? 'blue' : 'common'"
          (onCLick)="toggleFilesDisplay('all')"
        ></app-button>
        <app-button
          class="files-filter-btn-import"
          [class.chosen]="displayFiles === 'import'"
          height="auto"
          padding="9px 14px"
          text="импорт"
          textLike="like-body"
          radius="14px"
          [color]="displayFiles === 'import' ? 'blue' : 'common'"
          (onCLick)="toggleFilesDisplay('import')"
        ></app-button>
        <app-button
          class="files-filter-btn-export"
          [class.chosen]="displayFiles === 'export'"
          height="auto"
          padding="9px 14px"
          text="экспорт"
          textLike="like-body"
          radius="14px"
          [color]="displayFiles === 'export' ? 'blue' : 'common'"
          (onCLick)="toggleFilesDisplay('export')"
        ></app-button>
        <app-add-button
          class="add-btn"
          [title]="'добавить новый'"
          [target]="'file_add'"
        ></app-add-button>
      </div>
      <ng-container *ngIf="loading; else dummy">
        <div class="progress">
          <div class="indeterminate"></div>
        </div>
      </ng-container>
      <ng-template #dummy>
        <div class="dummy"></div>
      </ng-template>
      <div class="row space-between">
        <div class="list">
          <div class="list-header row space-between">
            <div class="sort-btn-wrapper">
              <app-sort-btn
                title="Название"
                [isSortAsc]="isNameSortAsc"
                (onCLick)="changeNameSortDir()"
              ></app-sort-btn>
            </div>
            <div class="sort-btn-wrapper">
              <app-sort-btn
                title="Размер"
                [isSortAsc]="isSizeSortAsc"
                (onCLick)="changeSizeSOrtDir()"
              ></app-sort-btn>
            </div>
            <div class="sort-btn-wrapper">
              <app-sort-btn
                title="Дата"
                [isSortAsc]="isDateSortAsc"
                (onCLick)="changeDateSortDir()"
              ></app-sort-btn>
            </div>
            <p class="text-body">Действия</p>
          </div>
          <div class="list-body">
            <ng-container
              *ngIf="
                device?.device_info?.files &&
                  device?.device_info?.files?.length !== 0;
                else nodata
              "
            >
              <app-file-item
                *ngFor="
                  let file of device.device_info.files
                    | search: searchTerm:'file'
                    | fileName: isNameSortAsc
                    | deviceFileSize: isSizeSortAsc
                    | fileDate: isDateSortAsc
                    | filesSort: displayFiles
                "
                [file]="file"
                [currFile]="currFile"
                (onFileClick)="setCurrentFile($event)"
                (onDeleteClick)="onDeleteClickHandler($event)"
                (onDownloadClick)="onDownloadClickHandler($event)"
              ></app-file-item>
            </ng-container>
          </div>
          <ng-template #nodata>
            <app-no-list-data></app-no-list-data>
          </ng-template>
        </div>
        <div class="preview-wrapper">
          <div
            class="preview r-14"
            [class.video]="currFile && fileType(currFile.url) === 'video'"
          >
            <span *ngIf="!currFile" class="text-choose">область просмотра</span>
            <ng-container *ngIf="currFile">
              <span
                *ngIf="
                  fileType(currFile.url) === 'none' ||
                  fileType(currFile.url) === 'other'
                "
                class="text-choose"
                >непросматриваемый файл</span
              >
              <img
                *ngIf="fileType(currFile.url) === 'img'"
                class="img"
                [src]="currFile?.url"
                alt=""
              />
              <video
                *ngIf="fileType(currFile.url) === 'video'"
                class="video"
                [src]="currFile.url"
                controls
                [disableRemotePlayback]="true"
                [controlsList]="['nodownload']"
              ></video>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-form-footer"></div>
  </div>
</app-modal>
